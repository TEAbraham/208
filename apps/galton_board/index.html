<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Firebase -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
      import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";
      import { firebaseConfig } from '../../js/firebase-config.js';

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      onAuthStateChanged(auth, (user) => {
          if (!user) {
              localStorage.setItem("redirectAfterLogin", window.location.href);
              window.location.href = "../../index.html";
          }
      });
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galton Board</title>

    <!-- CSS Imports -->
    <link rel="stylesheet" href="../../css/jquery-ui.css">
    <link rel="stylesheet" href="../../css/jquery.fullpage.css">
    <link rel="stylesheet" href="../../css/home.css">

    <!--Fonts-->
    <link href="//fonts.googleapis.com/css?family=Lato:100,200,300,400" rel="stylesheet">
    <!--Font Awesome-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!--Favicon-->
    <link rel="shortcut icon" type="image/png" href="../../img/favicon.png">

    <!-- JavaScript Imports -->
    <script src="../../js/jquery.min.js"></script>
    <script src="../../js/jquery-ui.js"></script>
    <script src="../../js/jStat.js"></script>
    <script src="../../js/LaTeXMathML.js"></script>
    <script src="../../js/d3.v7.min.js"></script>
    <script type="module" src="../../js/script.js"></script>
    <script type="module" src="../../js/home.js"></script>

    <style>
.interactive-wrapper {
  display: block;
  width: auto;
  margin: 0 auto;
  text-align: center;
}

.Row {
  display: table;
  width: 100%;
  table-layout: fixed;
  border-spacing: 10px;
}
.Column {
  display: table-cell;
  vertical-align: top;
}

#bernoulli-container,
#binomial-container,
#galton-container {
  background: white;
  margin: 40px auto;
  padding: 20px;
  width: 70%;
  height: 60%;
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  overflow: clip;
}

#galton-sliders input[type="range"] {
  margin-bottom: 10px;
}
#galton-board {
  display: block;
  margin: 0 auto;
  max-width: 100%;
  height: auto;
}


label {
  font-weight: bold;
  display: block;
  margin: 10px 0 5px;
}

input[type="range"] {
  width: 100%;
}

svg {
  max-width: 100%;
  height: auto;
  display: block;
}


.button-1.perspective {
  padding: 8px 15px;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.3s ease-in-out;
  border: 1px solid #46C8B2;
  background-color: white;
  color: #333;
}

.button-1.perspective.active,
.button-1.perspective:hover {
  background-color: #46C8B2;
  color: white;
}

.button-1.active,.button-1:hover, .button-1-s:hover{
   border: 1px solid #46C8B2;
   background-color: #46C8B2;
   color:white;
}

.bar.active {
  fill: #FF9B3C !important; /* Active bar color */
}

.tooltip {
  font-size: 12px;
  font-family: sans-serif;
  color: #333;
  background-color: white;
  border: 1px solid #ddd;
  border-radius: 4px;
  padding: 5px;
  pointer-events: none;
  box-shadow: 0px 0px 10px rgba(0,0,0,0.2);
  position: absolute;
  opacity: 0;
  z-index: 10;
}



@media screen and (min-width: 320px) {
    .axis text {
        font-size: 8px;
    }
}

@media screen and (min-width: 680px) {
    .axis text {
        font-size: 15px;
    }
}
</style>
  </head>

  <body>
    <header class="menu-top">
      <ul id="menu">
          <li class="dropdown">
              <a href="../../home/home.html" class="dropbtn">Home</a>
              <ul class="dropdown-content">
                  <li><a href="../../home/home.html#unit1">Unit 1</a></li>
                  <li><a href="../../home/home.html#unit2">Unit 2</a></li>
                  <li><a href="../../home/home.html#unit3">Unit 3</a></li>
                  <li><a href="../../home/home.html#unit4">Unit 4</a></li>
                  <li><a href="../../home/home.html#unit5">Unit 5</a></li>
                  <li><a href="../../home/home.html#unit6">Unit 6</a></li>
                  <li><a href="../../home/home.html#unit7">Unit 7</a></li>
                  <li><a href="../../home/home.html#unit8">Unit 8</a></li>
                  <li><a href="../../home/home.html#unit9">Unit 9</a></li>
              </ul>
          </li>
          <li class="dropdown">
              <a href="https://classroom.google.com/u/1/" class="dropbtn" target="_blank">Classroom</a>
              <ul class="dropdown-content">
                  <li><a href="https://classroom.google.com/u/1/c/NzA4OTk2OTI3MzAw" target="_blank">Announcements</a></li>
                  <li><a href="https://classroom.google.com/u/1/w/NzA4OTk2OTI3MzAw/t/all" target="_blank">Course Documents</a></li>
              </ul>
          </li>
          <li class="dropdown">
              <a href="../../apps" class="dropbtn">Apps</a>
              <ul class="dropdown-content">
                <li><a href="../../apps/conditional_probability/">Conditional Probability</a></li>
                <li><a href="../../apps/galton_board/">Galton Board</a></li>
                <li><a href="../../apps/normal_distribution/">Normal Distribution</a></li>
                <li><a href="../../apps/binomial_distribution/">Binomial Distribution</a></li>
                <li><a href="../../apps/geometric_distribution/">Geometric Distribution</a></li>
                <li><a href="../../apps/random_variables/">Random Variables</a></li>
                <li><a href="../../apps/sampling_distributions/">Sampling Distributions</a></li>
                <li><a href="../../apps/confidence_intervals/">Confidence Intervals</a></li>
              </ul>
          </li>
          <li class="dropdown">
            <a href="../../mcq/" class="dropbtn">MCQ</a>
          </li>
          <li class="dropdown">
            <a href="../../frq/" class="dropbtn">FRQ</a>
        </li>
        <li class="dropdown">
            <a href="../../collegeboard/" class="dropbtn">CollegeBoard</a>
        </li>
        <li class="dropdown">
            <a href="../../prep/" class="dropbtn">Exam Prep</a>
        </li>
          <li id="logoutButton" style="display:none;"><a href="../../index.html" onclick="logout('../../index.html')">Logout</a></li>
      </ul>
            <a href="../../admin/"><span id="user-email" style="color:darkgreen; margin-left: 1em;"></span></a>
      <div id="logo"></div>
  </header>
  <h1>The Galton Board</h1>
  <section class="Row">
    <div class="Column" id="galton-sliders">
      <label>Depth: <span id="depth-val">9</span></label>
      <input type="range" id="depth-slider" min="1" max="25" value="9">
      <label>Bias (% right): <span id="bias-val">50</span></label>
      <input type="range" id="bias-slider" min="0" max="100" value="50">
      <label>Speed: <span id="speed-val" style="display: none;">500</span></label>
      <input type="range" id="speed-slider" min="10" max="1000" value="500" >
      <button class="button-1 perspective" id="reset-btn">Reset</button>
      <button class="button-1 perspective" id="pause-btn">Pause</button>
      <div>
        <br>
      The Galton Board displays centuries old mathematical concepts in an innovative, dynamic desktop device.  It incorporates Sir Francis Galton's (1822-1911) invention from 1873 that illustrated the binomial distribution, which for a large number of rows of hexagons and a large number of beads approximates the normal distribution, a concept known as the Central Limit Theorem.  He was fascinated with the order of the bell curve that emerges from the apparent chaos of beads bouncing off of pegs in his board.  According to the Central Limit Theorem, more specifically, the de Moivre (1667-1754)-Laplace(1749-1827) theorem, the normal distribution may be used as an approximation to the binomial distribution under certain conditions.
        <br>
      </div>
    </div>

    <div class="Column" id="galton-container">
      <div id="galton-chart"></div>
    </div>
  </section>
<script>
  window.onload = function () {
  galton();
  document.querySelectorAll(".perspective").forEach((button) => {
    button.addEventListener("click", function () {
      document.querySelectorAll(".perspective").forEach((btn) =>
        btn.classList.remove("active")
      );
      this.classList.add("active");
      changePerspective(this.id);
      updateRects(1000);
    });
  });
};


function galton() {

  let fullWidth = document.getElementById("galton-container").clientWidth;

  // Galton Board Logic (Centered Pegs + Histogram + Reset/Pause Controls)

  function factorial(n) {
    if (n === 0 || n === 1) return 1;
    let result = 1;
    for (let i = 2; i <= n; i++) result *= i;
    return result;
  }

  // Galton Board Logic
  const galtonMargin = { top: 20, right: 30, bottom: 100, left: 30 };
  const galtonWidth = fullWidth;
  let galtonHeight = 600;
  const spacing = 40;

  let galtonSvg = d3.select("#galton-chart")
    .append("svg")
    .attr("width", galtonWidth)
    .attr("height", galtonHeight)
    .attr("id", "galton-svg");

  const galtonGroup = galtonSvg.append("g")
    .attr("transform", `translate(${galtonMargin.left},${galtonMargin.top})`);

  let galtonConfig = { size: 9, bias: 0.5, speed: 500, histogram: Array(10).fill(0) };

  const pegLayer = galtonGroup.append("g");
  const ballLayer = galtonGroup.append("g");
  const histLayer = galtonGroup.append("g");

  let dropping = true;

  function drawGaltonBoard() {
    pegLayer.selectAll("circle").remove();
    const size = galtonConfig.size;
    for (let row = 0; row < size; row++) {
      for (let col = 0; col <= row; col++) {
        const cx = galtonWidth / 2 - (row * spacing / 2) + col * spacing;
    const r = 10; // Radius of hex peg
    const angleOffset = Math.PI / 6; // 30° rotation

    const points = Array.from({ length: 6 }, (_, i) => {
      const angle = angleOffset + (Math.PI / 3) * i;
      const px = cx + r * Math.cos(angle);
      const py = row * spacing + r * Math.sin(angle);
      return [px, py];
    });

    const hex = pegLayer.append("polygon")
      .attr("points", points.map(p => p.join(",")).join(" "))
      .attr("fill", "#666")
      .attr("stroke", "#444")
      .attr("stroke-width", 1)
      .attr("transform", `translate(0, -20)`)
      .attr("opacity", 0);

    // Animate drop-in
    hex.transition()
      .delay((row + col) * 20)
      .duration(400)
      .attr("transform", `translate(0, 0)`)
      .attr("opacity", 1);

    // Hover effect (outside transition chain)
    hex.on("mouseover", function () {
        d3.select(this)
          .transition()
          .duration(200)
          .attr("fill", "#999");
      })
      .on("mouseout", function () {
        d3.select(this)
          .transition()
          .duration(200)
          .attr("fill", "#666");
      });




      }
    }
  }

  function dropBallAnimated() {
    if (!dropping) return;

    let x = galtonWidth / 2;
    let y = -10;
    let position = 0;
    let delay = 0;

    const ball = ballLayer.append("circle")
      .attr("r", 5)
      .attr("fill", "#46C8B2")
      .attr("cx", x)
      .attr("cy", y);

    for (let i = 0; i < galtonConfig.size; i++) {
      const right = Math.random() < galtonConfig.bias;
      if (right) position++;
      const r = 10; // same radius used for hex pegs
      const deflection = (Math.random() - 0.5) * 2; // ±1px
      const xNext = x + (right ? spacing / 2 : -spacing / 2) + deflection;
      const yBounce = y - r; // bounce off the top corner
      const yNext = y + spacing;


      ball.transition().delay(delay).duration(galtonConfig.speed / 2)
        .attr("cx", xNext).attr("cy", yBounce)
        .attr("fill", right ? "#46C8B2" : "#FF8686");

      ball.transition().delay(delay + galtonConfig.speed / 2).duration(galtonConfig.speed / 2)
        .attr("cy", yNext);

      x = xNext;
      y = yNext;
      delay += galtonConfig.speed;
    }
    // Update histogram AFTER ball finishes dropping
    ball.transition()
      .delay(delay)
      .duration(0)
      .on("end", () => {
        galtonConfig.histogram[position]++;
        updateGaltonHistogram();
        ball.transition().duration(1000).remove();
      });
  }
  function updateGaltonHistogram() {
    const bins = galtonConfig.histogram.length;
    const histHeight = 100;
    const maxCount = d3.max(galtonConfig.histogram);

    const x = d3.scaleLinear().domain([0, bins - 1]).range([
      galtonWidth / 2 - (bins - 1) * spacing / 2,
      galtonWidth / 2 + (bins - 1) * spacing / 2
    ]);
    const y = d3.scaleLinear().domain([0, maxCount || 1]).range([histHeight, 0]);

    const barWidth = spacing;
    const bars = histLayer.selectAll("rect").data(galtonConfig.histogram);

    bars.enter()
      .append("rect")
      .attr("x", (_, i) => galtonWidth / 2 - (bins - 1) * spacing / 2 + i * spacing)
      .attr("width", barWidth)
      .attr("y", y(0))
      .attr("height", 0)
      .attr("fill", "#64bdff")
      .merge(bars)
      .transition()
      .duration(300)
      .attr("x", (_, i) => x(i) - spacing / 2)
      .attr("width", spacing)
      .attr("y", d => y(d))
      .attr("height", d => histHeight - y(d));

    bars.exit().remove();

    const labels = histLayer.selectAll("text").data(galtonConfig.histogram);

    labels.enter()
      .append("text")
      .attr("text-anchor", "middle")
      .attr("fill", "#333")
      .attr("font-size", "12px")
      .merge(labels)
      .transition()
      .duration(300)
      .text(d => d)
      .attr("x", (_, i) => x(i))
      .attr("y", d => y(d) - 5);

    labels.exit().remove();

    histLayer.attr("transform", `translate(0, ${galtonConfig.size * spacing + 40})`);
  }

  document.getElementById("depth-slider").addEventListener("input", e => {
    const galtonSvgElement = document.getElementById("galton-svg");
    galtonConfig.size = +e.target.value;
    galtonHeight = galtonConfig.size >= 12 ? 1000 : 600;
    galtonSvgElement.setAttribute("height", galtonHeight);
    const val = +e.target.value;
    document.getElementById("depth-val").textContent = val;
    galtonConfig.size = val;
    galtonConfig.histogram = Array(val + 1).fill(0);
    updateGaltonHistogram();
    drawGaltonBoard();
  });

  document.getElementById("bias-slider").addEventListener("input", e => {
    const val = +e.target.value;
    document.getElementById("bias-val").textContent = val;
    galtonConfig.bias = val / 100;
    updateGaltonHistogram();
    drawGaltonBoard();
  });

  document.getElementById("speed-slider").addEventListener("input", e => {
    const val = 1010 - +e.target.value;
    document.getElementById("speed-val").textContent = val;
    galtonConfig.speed = val;
    updateGaltonHistogram();
    drawGaltonBoard();
  });

  document.getElementById("reset-btn").addEventListener("click", () => {
    galtonConfig.histogram = Array(galtonConfig.size + 1).fill(0);
    updateGaltonHistogram();
    drawGaltonBoard();
  });

  document.getElementById("pause-btn").addEventListener("click", () => {
    dropping = !dropping;
    document.getElementById("pause-btn").textContent = dropping ? "Pause" : "Resume";
  });

  updateGaltonHistogram();
  drawGaltonBoard();
  setInterval(dropBallAnimated, 500);
}
</script>
  <br><footer>Thomas Abraham © 2025</footer></body>
</html>
