[{"name": "app.py", "content": "# app.py\n\nfrom shiny import App, ui, reactive, render\nfrom shinywidgets import output_widget, render_widget\nimport plotly.graph_objects as go\nimport numpy as np\nfrom scipy.stats import binom, norm\nimport pandas as pd\n\n# UI Definition\napp_ui = ui.page_fluid(\n    ui.panel_title(\"The Binomial Distribution\"),\n    ui.navset_tab(\n        ui.nav_panel(\"Explore Distribution\",\n            ui.layout_sidebar(\n                ui.sidebar(\n                    ui.input_slider(\"n_slider\", \"Number of Bernoulli Trials (n)\", min=1, max=100, value=6, step=1),\n                    ui.input_slider(\"p_slider\", \"Probability of Success (p)\", min=0, max=1, value=0.5, step=0.01),\n                    ui.input_checkbox(\"use_inputs\", \"Enter numbers for n and p\", value=False),\n                    ui.panel_conditional(\n                        \"input.use_inputs\",\n                        ui.input_numeric(\"n_text\", \"n\", value=6, step=1, min=1, max=100),\n                        ui.input_numeric(\"p_text\", \"p\", value=0.5, min=0, max=1, step=0.01),\n                    ),\n                    ui.input_checkbox(\"overlay_normal\", \"Overlay Normal Distribution\", value=False),\n                    width=400\n                ),\n                    ui.tags.p(\"The binomial distribution models the number of successes in a fixed number of independent Bernoulli trials. The shape and center depend on the number of trials n and the probability of success p. Explore how the shape changes below.\"),\n                    output_widget(\"dist_plot\", height=\"400px\"),\n                    ui.tags.p(\"The orange bars represent the binomial probabilities for each number of successes. If selected, the gray line represents the normal approximation.\"),\n                    ui.tags.h4(\"Probability Table:\"),\n                    ui.output_ui(\"prob_table\")\n            )\n        ),\n        ui.nav_panel(\"Find Probability\",\n            ui.layout_sidebar(\n                ui.sidebar(\n                    ui.input_numeric(\"prob_n\", \"Number of Trials (n)\", value=10, min=1, max=100, step=1),\n                    ui.input_numeric(\"prob_p\", \"Probability of Success (p)\", value=0.5, min=0, max=1, step=0.01),\n                    ui.input_select(\"prob_type\", \"Type of Probability\", choices=[\n                        \"Binomial Probability: P(X = x)\",\n                        \"Lower Tail: P(X < x)\",\n                        \"Upper Tail: P(X > x)\",\n                        \"Interval: P(x\u2081 < X < x\u2082)\"\n                    ]),\n                    ui.panel_conditional(\n                        \"!input.prob_type.includes('Interval')\",\n                        ui.input_numeric(\"x1_prob\", \"Value of x:\", value=5, step=1)\n                    ),\n                    ui.panel_conditional(\n                        \"input.prob_type.includes('Interval')\",\n                        ui.input_numeric(\"x1_prob\", \"x\u2081:\", value=5, step=1),\n                        ui.input_numeric(\"x2_prob\", \"x\u2082:\", value=7, step=1)\n                ),\n                    width=400),\n                    output_widget(\"prob_plot\", height=\"400px\"),\n                    ui.output_ui(\"prob_summary\")\n                )\n            ),\n        ui.nav_panel(\"Find Percentile\",\n            ui.layout_sidebar(\n                ui.sidebar(\n                    ui.input_numeric(\"perc_n\", \"Number of Trials (n)\", value=10, min=1, max=100, step=1),\n                    ui.input_numeric(\"perc_p\", \"Probability of Success (p)\", value=0.5, min=0, max=1, step=0.01),\n                    ui.input_select(\"perc_type\", \"Type of Percentile\", choices=[\n                        \"Lower Tail: P(X < x)\",\n                        \"Upper Tail: P(X > x)\",\n                        \"Middle Interval: P(x\u2081 < X < x\u2082)\"\n                    ]),\n                    ui.input_numeric(\"perc_prob\", \"Probability (%)\", value=95, min=0, max=100, step=0.1),\n                    width=400\n                ),\n                    output_widget(\"perc_plot\", height=\"400px\"),\n                    ui.output_ui(\"perc_summary\")\n            )\n        )\n    )\n)\n\n# Server Logic\ndef server(input, output, session):\n\n    @reactive.Calc\n    def get_params():\n        n = input.n_text() if input.use_inputs() else input.n_slider()\n        p = input.p_text() if input.use_inputs() else input.p_slider()\n        return int(n), float(p)\n\n    @output\n    @render_widget\n    def dist_plot():\n        n, p = get_params()\n        x = np.arange(0, n + 1)\n        y = binom.pmf(x, n, p)\n\n        fig = go.Figure()\n        fig.add_trace(go.Bar(\n            x=x,\n            y=y,\n            marker_color=\"#FF9B3C\",\n            name=\"Binomial P(X = x)\",\n            hovertemplate=\"x = %{x}<br>P(X = %{x}) = %{y:.4f}<extra></extra>\",\n        ))\n\n        if input.overlay_normal():\n            mu, sigma = n * p, np.sqrt(n * p * (1 - p))\n            x_cont = np.linspace(0, n, 400)\n            y_norm = norm.pdf(x_cont, mu, sigma)\n            fig.add_trace(go.Scatter(x=x_cont, y=y_norm, mode='lines', name=\"Normal Approximation\", line=dict(color=\"gray\")))\n\n        fig.update_layout(\n            title=f\"Binomial Distribution (n={n}, p={p})\",\n            xaxis_title=\"x\",\n            yaxis_title=\"P(X = x)\",\n            margin=dict(l=40, r=40, t=40, b=40)\n        )\n        return fig\n\n    @output\n    @render.ui\n    def prob_table():\n        n, p = get_params()\n        x_vals = np.arange(0, n + 1)\n        probs = binom.pmf(x_vals, n, p)\n\n        rows = \"\\n\".join(\n            f\"<tr><td align='center'>{x}</td><td align='center'>{prob:.5f}</td></tr>\"\n            for x, prob in zip(x_vals, probs)\n        )\n\n        html = f\"\"\"\n        <table class='table shiny-table table-hover spacing-s' style='width:auto;'>\n        <thead>\n            <tr>\n                <th style='text-align: center;'>x</th>\n                <th style='text-align: center;'>P(X = x)</th>\n            </tr>\n        </thead>\n        <tbody>{rows}</tbody>\n        </table>\n        \"\"\"\n        return ui.HTML(html)\n\n    @output\n    @render_widget\n    def prob_plot():\n        n, p = input.prob_n(), input.prob_p()\n        x = np.arange(0, n + 1)\n        y = binom.pmf(x, n, p)\n\n        prob_type = input.prob_type()\n\n        x1 = input.x1_prob()\n        x2 = input.x2_prob() if hasattr(input, 'x2_prob') else None\n\n\n        fig = go.Figure()\n        fig.add_trace(go.Bar(x=x, y=y, marker_color=\"#eee\", hoverinfo='x+y'))\n\n        highlight = np.zeros_like(y)\n        if \"Binomial Probability\" in prob_type:\n            if 0 <= x1 <= n:\n                highlight[int(x1)] = y[int(x1)]\n                result = y[int(x1)]\n        elif \"Lower\" in prob_type:\n            mask = x < x1\n            highlight[mask] = y[mask]\n            result = np.sum(y[mask])\n        elif \"Upper\" in prob_type:\n            mask = x > x1\n            highlight[mask] = y[mask]\n            result = np.sum(y[mask])\n        elif \"Interval\" in prob_type:\n            mask = (x > x1) & (x < x2)\n            highlight[mask] = y[mask]\n            result = np.sum(y[mask])\n\n        fig.add_trace(go.Bar(\n            x=x,\n            y=highlight,\n            marker_color=\"#FF9B3C\",\n            hovertemplate=\"x = %{x}<br>P(X = %{x}) = %{y:.4f}<extra></extra>\",\n            name=\"Highlighted\"\n        ))\n\n        fig.update_layout(\n            title=\"Binomial Probability Visualization\",\n            xaxis_title=\"x\",\n            yaxis_title=\"P(X = x)\",\n            showlegend=False\n        )\n        return fig\n\n    @output\n    @render.ui\n    def prob_summary():\n        n, p = input.prob_n(), input.prob_p()\n        x1 = input.x1_prob()\n        x2 = input.x2_prob() if hasattr(input, 'x2_prob') else None\n        prob_type = input.prob_type()\n\n        if \"Binomial Probability\" in prob_type:\n            result = binom.pmf(x1, n, p)\n            msg = f\"P(X = {x1}) = {result:.4f}\"\n        elif \"Lower\" in prob_type:\n            result = binom.cdf(x1 - 1, n, p)\n            msg = f\"P(X < {x1}) = {result:.4f}\"\n        elif \"Upper\" in prob_type:\n            result = 1 - binom.cdf(x1, n, p)\n            msg = f\"P(X > {x1}) = {result:.4f}\"\n        elif \"Interval\" in prob_type:\n            result = binom.cdf(x2 - 1, n, p) - binom.cdf(x1, n, p)\n            msg = f\"P({x1} < X < {x2}) = {result:.4f}\"\n        else:\n            msg = \"Invalid selection.\"\n\n        return ui.tags.p(msg)\n\n    @output\n    @render_widget\n    def perc_plot():\n        n, p = input.perc_n(), input.perc_p()\n        prob = input.perc_prob() / 100\n        perc_type = input.perc_type()\n\n        x = np.arange(0, n + 1)\n        y = binom.pmf(x, n, p)\n\n        fig = go.Figure()\n        fig.add_trace(go.Bar(x=x, y=y, marker_color=\"#eee\"))\n\n        if \"Lower\" in perc_type:\n            x_val = np.argmax(binom.cdf(x, n, p) >= prob)\n            bar_colors = [\"#FF9B3C\" if i <= x_val else \"#eee\" for i in x]\n        elif \"Upper\" in perc_type:\n            x_val = np.argmax(binom.cdf(x, n, p) >= 1 - prob)\n            bar_colors = [\"#FF9B3C\" if i >= x_val else \"#eee\" for i in x]\n        elif \"Middle\" in perc_type:\n            low_tail = (1 - prob) / 2\n            low_x = np.argmax(binom.cdf(x, n, p) >= low_tail)\n            high_x = np.argmax(binom.cdf(x, n, p) >= 1 - low_tail)\n            bar_colors = [\"#FF9B3C\" if low_x <= i <= high_x else \"#eee\" for i in x]\n        else:\n            bar_colors = [\"#eee\"] * len(x)\n\n        fig.data[0].marker.color = bar_colors\n        fig.update_layout(\n            title=\"Percentile Range Highlight\",\n            xaxis_title=\"x\",\n            yaxis_title=\"P(X = x)\",\n            showlegend=False\n        )\n        return fig\n\n    @output\n    @render.ui\n    def perc_summary():\n        n, p = input.perc_n(), input.perc_p()\n        prob = input.perc_prob() / 100\n        perc_type = input.perc_type()\n        x = np.arange(0, n + 1)\n\n        if \"Lower\" in perc_type:\n            val = np.argmax(binom.cdf(x, n, p) >= prob)\n            msg = f\"x such that P(X < x) \u2248 {prob:.2%} is x = {val}\"\n        elif \"Upper\" in perc_type:\n            val = np.argmax(binom.cdf(x, n, p) >= 1 - prob)\n            msg = f\"x such that P(X > x) \u2248 {prob:.2%} is x = {val}\"\n        elif \"Middle\" in perc_type:\n            low_tail = (1 - prob) / 2\n            low = np.argmax(binom.cdf(x, n, p) >= low_tail)\n            high = np.argmax(binom.cdf(x, n, p) >= 1 - low_tail)\n            msg = f\"x values such that P(x\u2081 < X < x\u2082) \u2248 {prob:.2%} are x \u2208 [{low}, {high}]\"\n        else:\n            msg = \"Invalid input.\"\n\n        return ui.tags.p(msg)\n\n\napp = App(app_ui, server)\n", "type": "text"}]