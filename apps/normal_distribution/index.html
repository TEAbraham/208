<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Normal Distribution Explorer</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .tabs { display: flex; gap: 10px; margin-bottom: 10px; }
    .tab { padding: 8px 12px; background: #eee; border: 1px solid #ccc; cursor: pointer; }
    .tab.active { background: #ddd; font-weight: bold; }
    .tab-content { display: none; margin-top: 10px; }
    .tab-content.active { display: block; }
    .layout { display: flex; gap: 20px; }
    .sidebar { flex: 1; min-width: 240px; }
    .main { flex: 3; }
    svg { background: #fafafa; border: 1px solid #ccc; }
    label { display: block; margin-top: 10px; }
    input, select { width: 100%; padding: 4px; margin-top: 2px; }
    table { margin-top: 15px; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 5px 10px; text-align: center; }
    .input-row { display: flex; justify-content: space-between; gap: 10px; }
  </style>
</head>
<body>

<h2>Normal Distribution Explorer</h2>
<div class="tabs">
  <div class="tab active" data-tab="explore">Explore Distribution</div>
  <div class="tab" data-tab="probability">Find Probability</div>
  <div class="tab" data-tab="percentile">Find Percentile</div>
</div>

<div id="explore" class="tab-content active">
  <div class="layout">
    <div class="sidebar">
      <div id="input-toggle-area">
        <label><input type="checkbox" id="toggle-manual"> Use manual inputs</label>
      </div>
      <div id="slider-inputs">
        <label>Mean (μ): <span id="mu-label"></span></label>
        <input id="mu" type="range" min="-5" max="100" step="0.1" value="0" />
        <label>Standard Deviation (σ): <span id="sigma-label"></span></label>
        <input id="sigma" type="range" min="0.1" max="30" step="0.1" value="1" />
      </div>
      <div id="manual-inputs" style="display:none;">
        <label>Mean (μ): <input id="mu-manual" type="number" value="0" step="0.1" /></label>
        <label>Standard Deviation (σ): <input id="sigma-manual" type="number" value="1" step="0.1" /></label>
      </div>
    </div>
    <div class="main">
      <svg id="explore-chart" width="700" height="400"></svg>
      <p id="explore-desc"></p>
      <table id="explore-table"></table>
    </div>
  </div>
</div>

<div id="probability" class="tab-content">
  <div class="layout">
    <div class="sidebar">
      <label>μ: <input id="prob-mu" type="number" value="0" step="0.1"></label>
      <label>σ: <input id="prob-sigma" type="number" value="1" step="0.1"></label>
      <label>Type:
        <select id="prob-type">
          <option value="lt">P(X < x)</option>
          <option value="gt">P(X > x)</option>
          <option value="between">P(x₁ < X < x₂)</option>
        </select>
      </label>
      <label id="label-prob-x1"><span>x or x₁:</span> <input id="prob-x1" type="number" value="1.96" step="0.1"></label>
      <label id="label-prob-x2" style="display: none;">x₂: <input id="prob-x2" type="number" value="2.5" step="0.1"></label>
    </div>
    <div class="main">
      <svg id="prob-chart" width="700" height="400"></svg>
      <p id="prob-desc"></p>
      <table id="prob-table"></table>
    </div>
  </div>
</div>

<div id="percentile" class="tab-content">
  <div class="layout">
    <div class="sidebar">
      <label>μ: <input id="perc-mu" type="number" value="0" step="0.1"></label>
      <label>σ: <input id="perc-sigma" type="number" value="1" step="0.1"></label>
      <label>Percentile Type:
        <select id="perc-type">
          <option value="lower">Lower Tail</option>
          <option value="upper">Upper Tail</option>
          <option value="middle">Middle Interval</option>
        </select>
      </label>
      <label>Probability (%): <input id="perc-prob" type="number" value="95" step="0.1"></label>
    </div>
    <div class="main">
      <svg id="perc-chart" width="700" height="400"></svg>
      <p id="perc-desc"></p>
      <table id="perc-table"></table>
    </div>
  </div>
</div>

<script>
// === Utility Functions ===
const erf = x => {
  const t = 1 / (1 + 0.5 * Math.abs(x));
  const tau = t * Math.exp(-x*x - 1.26551223 + t*(1 + t*(.37409196 + t*(.09678418 + t*(-.18628806 + t*(.27886807 + t*(-1.13520398 + t*(1.48851587 + t*(-.82215223 + t*.17087277)))))))));
  return x >= 0 ? 1 - tau : tau - 1;
};
const normalPDF = (x, mu, sigma) => (1 / (sigma * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * ((x - mu) / sigma) ** 2);
const normalCDF = (x, mu, sigma) => 0.5 * (1 + erf((x - mu) / (sigma * Math.sqrt(2))));
const erfInv = z => {
  let a = 0.147; let the_sign_of_x = z < 0 ? -1 : 1;
  let ln = Math.log(1 - z*z);
  let x = Math.sqrt(Math.sqrt((2/(Math.PI*a) + ln/2)**2 - ln/a) - (2/(Math.PI*a) + ln/2));
  return the_sign_of_x * x;
};

// === Tab Switching ===
document.querySelectorAll(".tab").forEach(tab => {
  tab.addEventListener("click", () => {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
    tab.classList.add("active");
    document.getElementById(tab.dataset.tab).classList.add("active");
    update();
  });
});

// === Toggle Slider/Input ===
document.getElementById("toggle-manual").addEventListener("change", e => {
  const manual = e.target.checked;
  document.getElementById("slider-inputs").style.display = manual ? "none" : "block";
  document.getElementById("manual-inputs").style.display = manual ? "block" : "none";
});

// === Conditionally Show x2 Input ===
function updateProbInputVisibility() {
  const type = document.getElementById("prob-type").value;
  const isBetween = type === "between";
  document.getElementById("label-prob-x2").style.display = isBetween ? "block" : "none";
  document.querySelector("#label-prob-x1 span").textContent = isBetween ? "x₁:" : "x:";
}
document.getElementById("prob-type").addEventListener("change", () => {
  updateProbInputVisibility();
  update();
});

// === Bind Slider Labels ===
function syncSliderLabels() {
  const mu = document.getElementById("mu").value;
  const sigma = document.getElementById("sigma").value;
  document.getElementById("mu-label").textContent = mu;
  document.getElementById("sigma-label").textContent = sigma;
  document.getElementById("mu-manual").value = mu;
  document.getElementById("sigma-manual").value = sigma;
}
["mu", "sigma"].forEach(id => document.getElementById(id).addEventListener("input", () => {
  syncSliderLabels();
  update();
}));
document.getElementById("mu-manual").addEventListener("input", e => {
  document.getElementById("mu").value = e.target.value;
  syncSliderLabels(); update();
});
document.getElementById("sigma-manual").addEventListener("input", e => {
  document.getElementById("sigma").value = e.target.value;
  syncSliderLabels(); update();
});

// === Main Update Function ===
function update() {
  syncSliderLabels();
  const active = document.querySelector(".tab.active").dataset.tab;
  if (active === "explore") {
    const mu = parseFloat(document.getElementById("mu").value);
    const sigma = parseFloat(document.getElementById("sigma").value);
    const svg = d3.select("#explore-chart");
    svg.selectAll("*").remove();
    const width = +svg.attr("width") - 40, height = +svg.attr("height") - 40;
    const g = svg.append("g").attr("transform", "translate(40,20)");
    const x = d3.scaleLinear().domain([mu - 5, mu + 5]).range([0, width]);
    const y = d3.scaleLinear().domain([0, normalPDF(mu, mu, sigma)]).range([height, 0]);
    const data = d3.range(mu - 5, mu + 5, 0.1).map(d => ({x: d, y: normalPDF(d, mu, sigma)}));
    const area = d3.area().x(d => x(d.x)).y0(height).y1(d => y(d.y));
    g.append("path").datum(data.filter(d => Math.abs(d.x - mu) <= sigma)).attr("fill", "#9ecae1").attr("fill-opacity", 0.6).attr("d", area);
    g.append("path").datum(data.filter(d => Math.abs(d.x - mu) <= 2*sigma)).attr("fill", "#6baed6").attr("fill-opacity", 0.4).attr("d", area);
    g.append("path").datum(data.filter(d => Math.abs(d.x - mu) <= 3*sigma)).attr("fill", "#3182bd").attr("fill-opacity", 0.2).attr("d", area);
    g.append("path").datum(data).attr("stroke", "black").attr("fill", "none").attr("d", d3.line().x(d => x(d.x)).y(d => y(d.y)));
    g.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x));
    g.append("g").call(d3.axisLeft(y));
    const table = `<tr><th>μ</th><th>σ</th><th>μ-σ</th><th>μ+σ</th><th>μ-2σ</th><th>μ+2σ</th><th>μ-3σ</th><th>μ+3σ</th></tr>
      <tr><td>${mu}</td><td>${sigma}</td>
      <td>${(mu - sigma).toFixed(2)}</td><td>${(mu + sigma).toFixed(2)}</td>
      <td>${(mu - 2*sigma).toFixed(2)}</td><td>${(mu + 2*sigma).toFixed(2)}</td>
      <td>${(mu - 3*sigma).toFixed(2)}</td><td>${(mu + 3*sigma).toFixed(2)}</td></tr>`;
    document.getElementById("explore-table").innerHTML = table;
  } else if (active === "probability") {
  const mu = +document.getElementById("prob-mu").value;
  const sigma = +document.getElementById("prob-sigma").value;
  const x1 = +document.getElementById("prob-x1").value;
  const x2 = +document.getElementById("prob-x2").value;
  const type = document.getElementById("prob-type").value;

  const svg = d3.select("#prob-chart");
  svg.selectAll("*").remove();
  const width = +svg.attr("width") - 40, height = +svg.attr("height") - 40;
  const g = svg.append("g").attr("transform", "translate(40,20)");
  const x = d3.scaleLinear().domain([mu - 5, mu + 5]).range([0, width]);
  const y = d3.scaleLinear().domain([0, normalPDF(mu, mu, sigma)]).range([height, 0]);
  const data = d3.range(mu - 5, mu + 5, 0.1).map(d => ({x: d, y: normalPDF(d, mu, sigma)}));

  let shade = [mu - 5, mu + 5];
  if (type === "lt") shade = [mu - 5, x1];
  else if (type === "gt") shade = [x1, mu + 5];
  else shade = [x1, x2];

  const area = d3.area().x(d => x(d.x)).y0(height).y1(d => y(d.y));
  g.append("path").datum(data.filter(d => d.x >= shade[0] && d.x <= shade[1])).attr("fill", "orange").attr("fill-opacity", 0.3).attr("d", area);
  g.append("path").datum(data).attr("stroke", "black").attr("fill", "none").attr("d", d3.line().x(d => x(d.x)).y(d => y(d.y)));
  g.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x));
  g.append("g").call(d3.axisLeft(y));

  let prob = 0, label = "";
  if (type === "lt") { prob = normalCDF(x1, mu, sigma); label = `P(X < ${x1})`; }
  else if (type === "gt") { prob = 1 - normalCDF(x1, mu, sigma); label = `P(X > ${x1})`; }
  else { prob = normalCDF(x2, mu, sigma) - normalCDF(x1, mu, sigma); label = `P(${x1} < X < ${x2})`; }
  document.getElementById("prob-desc").textContent = `${label} ≈ ${prob.toFixed(4)}`;
  const z = ((type === "between") ? "—" : ((x1 - mu) / sigma).toFixed(2));
  const table = `<tr><th>μ</th><th>σ</th><th>Value(s)</th><th>Probability</th><th>z-Score</th></tr>
    <tr><td>${mu}</td><td>${sigma}</td><td>${type === "between" ? `${x1}, ${x2}` : x1}</td><td>${prob.toFixed(4)}</td><td>${z}</td></tr>`;
  document.getElementById("prob-table").innerHTML = table;
  } else if (active === "percentile") {
    const mu = +document.getElementById("perc-mu").value;
    const sigma = +document.getElementById("perc-sigma").value;
    const prob = +document.getElementById("perc-prob").value / 100;
    const type = document.getElementById("perc-type").value;
    const svg = d3.select("#perc-chart");
    svg.selectAll("*").remove();
    const width = +svg.attr("width") - 40, height = +svg.attr("height") - 40;
    const g = svg.append("g").attr("transform", "translate(40,20)");
    const x = d3.scaleLinear().domain([mu - 20, mu + 20]).range([0, width]);
    const y = d3.scaleLinear().domain([0, normalPDF(mu, mu, sigma)]).range([height, 0]);
    const data = d3.range(mu - 20, mu + 20, 0.1).map(d => ({x: d, y: normalPDF(d, mu, sigma)}));
    let shade = [mu - 4*sigma, mu + 4*sigma];
    if (type === "lower") shade = [mu - 4*sigma, mu + sigma * Math.sqrt(2) * erfInv(2*prob - 1)];
    else if (type === "upper") shade = [mu + sigma * Math.sqrt(2) * erfInv(2*(1 - prob) - 1), mu + 4*sigma];
    else {
      const low = mu + sigma * Math.sqrt(2) * erfInv(2*((1 - prob)/2) - 1);
      const high = mu + sigma * Math.sqrt(2) * erfInv(2*(1 - (1 - prob)/2) - 1);
      shade = [low, high];
    }
    const area = d3.area().x(d => x(d.x)).y0(height).y1(d => y(d.y));
    g.append("path").datum(data.filter(d => d.x >= shade[0] && d.x <= shade[1])).attr("fill", "orange").attr("fill-opacity", 0.3).attr("d", area);
    g.append("path").datum(data).attr("stroke", "black").attr("fill", "none").attr("d", d3.line().x(d => x(d.x)).y(d => y(d.y)));
    g.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x));
    g.append("g").call(d3.axisLeft(y));
    const val = type === "middle" ? `${shade[0].toFixed(2)} to ${shade[1].toFixed(2)}` : shade[1].toFixed(2);
    const z = type === "middle" ? "±" + (Math.abs(shade[1] - mu) / sigma).toFixed(2) : (Math.abs(shade[1] - mu) / sigma).toFixed(2);
    const table = `<tr><th>μ</th><th>σ</th><th>Value(s)</th><th>Percent</th><th>z-Score</th></tr>
      <tr><td>${mu}</td><td>${sigma}</td><td>${val}</td><td>${(prob*100).toFixed(1)}%</td><td>${z}</td></tr>`;
    document.getElementById("perc-table").innerHTML = table;
  }
}
document.querySelectorAll("input, select").forEach(e => e.addEventListener("input", update));
document.addEventListener("DOMContentLoaded", () => {
  syncSliderLabels();
  updateProbInputVisibility();
  update();
});
</script>

</body>
</html>
